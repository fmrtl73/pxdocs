---
title: Install Portworx on Azure Red Hat OpenShift
linkTitle: Azure Red Hat OpensShift
weight: 200
keywords: Install, on-premises, OpenShift, kubernetes, k8s, ARO, Azure, OpenShift
description: Install Portworx on Azure Red Hat OpenShift
linkTitle: Install on Azure Red Hat OpenShift
---

## Prerequisites

* [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli)
* Logged in to your Azure account through the [CLI](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli)

## Procedure

* Follow the [cluster creation tutorial](https://docs.microsoft.com/en-us/azure/openshift/tutorial-create-cluster ) on the Microsoft Azure documentation, including the *Get a Red Hat pull secret (optional)* section.
* Follow the [cluster connection tutorial](https://docs.microsoft.com/en-us/azure/openshift/tutorial-connect-cluster) on the Microsoft Azure documentation.


### Find the ARO Service Principal

When deploying Portworx on Azure Redhat Openshift (ARO), the virtual machines are created in a resource group with a `Deny Assignment` role that prevents any service principal from accessing virtual machines except the service principal created for the resource group. In this task, you identify the service principal for the resource group that has access, and configure it to pass on the credentials (Azure Client ID, Azure Client Secret, and Tenant ID) via the Portworx cluster spec. Portworx will fetch the `px-azure` secret object file to authenticate. Perform the following steps from your Azure Web UI:

1. Select **Virtual Machines** from the top navigation menu.
2. From the *Virtual machines* page, select the **Resource Group** associated with your cluster.
3. From the left panel on the **Resource group** page, select **Access control (IAM)**.
4. On the **Access control (IAM)** subpage of your resource group, select **Deny assignments** from the toolbar in the center of the page, then select the link under the **Name** column (this will likely be an autogenerated string of letters and numbers).
5. This page shows that all principals are denied access, except for your resource group. Select your resource group's name.
6. From the application page, copy and save the following values: 
    * Name
    * Application ID
    * Object ID
    
    You will use these to create the `px-azure` secret.

7. From the home page, open the **Azure Active Directory** page (select **All services** to see the option). Select **App registrations** on the left pane, followed by *All applications*. In the search bar in the center of the page, paste the application name you saved in the previous step and press the enter key. Select the application link that shows in the results to open the next page.
8. From your application's page, select **Certificates & secrets** under **Manage** from the left pane.
9. From the **Certificates & secrets** page, select **+ New client secret** to create a new secret. On the **Add a client secret** page, provide the description and expiry date of your secret and click **Add**. 
10. You can see the newly crated secret listed on the **Client secret** subpage. Copy and save the following values of your newly created secret:
  * Value 
  * Secret ID

### Create the px-azure secret with Service Principal credentials

Create a secret called `px-azure` to give Portworx access to Azure APIs by updating the following fields with the associated fields from the service principal you created in the previous section.

  ```text
   ./oc create secret generic -n kube-system px-azure\
   --from-literal=AZURE_TENANT_ID=<tenant> \
   --from-literal=AZURE_CLIENT_ID=<appId> \
  --from-literal=AZURE_CLIENT_SECRET=<value>
  ```
  ```output
  secret/px-azure created
  ```
   * `AZURE_TENANT_ID`: Run the `az login` command to get this value 
   * `AZURE_CLIENT_ID`: Provide the Application ID associated with your cluster's resource group, which you saved in step 6 of the previous section
   * `AZURE_CLIENT_SECRET`: Provide the Value of your secret, which you saved in the step 10 of the previous section
### Generate Portworx spec

1. Navigate to [PX-Central](https://central.portworx.com/) to generate an installation spec: 

2. Click **Continue** with thePortworx Enterprise option:
  ![PX option screen](/img/aro/image1.png)

3. Choose an appropriate license for your requirement and click **Continue**:
  ![PX license screen](/img/aro/image2.png)

4. On the **Basic** tab, select **Use the Portworx Operator** and select the Portworx version you want. Choose **Built-in** ETCD if you have no external ETCD cluster.

5. On **Storage** tab, select **Cloud** as your environment, **AZURE** as cloud platform, and click **Next**:
  ![Your Environment](/img/aro/image4.png)

6. On the **Network** tab, choose your network and click **Next**.
7. On the **Customize** page, select **Azure Kubernetes Service (AKS)** option, and click **Finish**:
  ![Other environment](/img/aro/image6.png)

8. Download the Portworx spec as a YAML file, and append the `osft=true` and `portworx.io/is-openshift: "true"` values to the `annotations` field. 
  
    Following is a sample spec for your reference:

    ```   
    # SOURCE: https://install.portworx.com/?operator=true&mc=false&kbver=&b=true&kd=type%3DPremium_LRS%2Csize%3D150&s=%22type%3DPremium_LRS%2Csize%3D150%22&c=px-cluster-068edac2-6b76-4a58-9227-bbeccb6c0928&aks=true&stork=true&csi=true&mon=true&tel=false&st=k8s&promop=true
    kind: StorageCluster
    apiVersion: core.libopenstorage.org/v1
    metadata:
      name: px-cluster-068edac2-6b76-4a58-9227-bbeccb6c0928
      namespace: kube-system
      annotations:
        portworx.io/install-source: "https://install.portworx.com/?operator=true&mc=false&kbver=&b=true&kd=type%3DPremium_LRS%2Csize%3D150&s=%22type%3DPremium_LRS%2Csize%3D150%22&c=px-cluster-068edac2-6b76-4a58-9227-bbeccb6c0928&aks=true&osft=true&stork=true&csi=true&mon=true&tel=false&st=k8s&promop=true"
        portworx.io/is-aks: "true"
        portworx.io/is-openshift: "true"
    spec:
    ...
    ```
### Install Portworx Operator using OpenShift UI

1. From your OpenShift UI, select **OperatorHub** in the left pane.

2. On the **OperatorHub** page, search for Portworx and select **Portworx Enterprise** or **Portworx Essentials** card: 

    ![search catalog](/img/aro/oc-px-search-catalog.png)

3. Click **Install** to install Portworx Operator:

    ![select catalog](/img/openshift-vsphere/image17-2.png)

4. Portworx Operator begins to install and takes you to the **Install Operator** page. On this page, select **A specific namespace on the cluster** option for **Installation mode**, and select **kube-system** from the **Installed Namespace** dropdown: 
   
    ![Installed operator page](/img/aro/oc-namesapce-operator.png)

5. Click **Install** to install Portworx Operator in the `kube-system` namespace.

### Deploy Portworx using OpenShift UI
 
1. Navigate to the **Installed Operator** page. Choose kube-system from the **Project** dropdown and select **Portworx Enterprise**:

    ![Portworx Operator](/img/aro/aro-kube-system.png)

2. Select **Create StorageCluster** to create a StorageCluster object:

    ![Portworx Operator](/img/aro/aro-storagecluster.png)

3. On the **Create StorageCluster** page, choose **YAML view** to configure the StorageCluster object.

4. Copy and paste the edited Portworx spec that you generated in the *Generate Portworx spec* section into the text-editor, and click **Create** to deploy Portworx: 

    ![YAML view](/img/aro/oc-config-yaml.png)
   
5. Verify that Portworx has deployed successfully by navigating to the **Storage Cluster** tab of the Installed Operators page. Once Portworx has fully deployed, the status will show as Online:

      ![Portworx status](/img/aro/portworx-installed.png)

{{< content "shared/portworx-install-with-kubernetes-post-install.md" >}}